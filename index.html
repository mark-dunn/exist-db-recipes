<div xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xf="http://www.w3.org/2002/xforms" data-template="templates:surround" data-template-with="templates/page.html" data-template-at="container-body" data-template-options="noscript=yes">
    <!-- 
    
    https://www.balisage.net/Proceedings/vol10/print/Niedl01/BalisageVol10-Niedl01.html
    
    -->
    <xf:model>
        <xf:instance xmlns="" id="all">
            <recipes/>
        </xf:instance>
        <xf:instance xmlns="" id="recipe-template">
            <recipe>
                <title/>
                <ingredients>
                    <ingredient/>
                </ingredients>
                <method>
                    <step/>
                </method>
            </recipe>
        </xf:instance>
        <xf:instance xmlns="" id="search-instance">
            <parameters>
                <query/>
                <field>ingredient</field>
            </parameters>
        </xf:instance>
        <xf:bind id="recipe-id" nodeset="//recipe/id/text()" relevant="true()"/>
        <xf:submission id="load" resource="/exist/restxq/recipes" method="get" replace="instance" instance="all">
            <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe list loaded.</xf:message>
        </xf:submission>
        <xf:submission id="save" resource="/exist/restxq/recipe" method="put" replace="instance" ref="//recipe[index('recipe-repeat')]">
            <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe saved.</xf:message>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">An error occurred.</xf:message>
        </xf:submission>
        <xf:submission id="delete" resource="/exist/restxq/recipe/{instance('all')//recipe[index('recipe-repeat')]/id/text()}" method="delete" replace="instance">
            <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe deleted.</xf:message>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">An error occurred.</xf:message>
        </xf:submission>
        <xf:submission id="search" resource="/exist/restxq/search" method="get" serialization="application/x-www-form-urlencoded" ref="instance('search-instance')" targetref="instance('all')" replace="instance"/>
        <xf:action ev:event="xforms-ready">
            <xf:message level="ephemeral">Loading recipe list...</xf:message>
            <xf:send submission="load"/>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
            <xf:message>Submit Error! Resource-uri: <xf:output value="event('resource-uri')"/>
                Response-reason-phrase: <xf:output value="event('response-reason-phrase')"/>
            </xf:message>
        </xf:action>
    </xf:model>
    <div class="row">
        <div class="col-md-8">
            <div class="page-header">
                <h1 data-template="config:app-title">Generated page</h1>
            </div>
            <div class="alert alert-success">
                <p>
                    <a data-template="templates:load-source" href="index.html">This</a> is the entry page into your application 
                and was generated by eXide. It uses HTML templates for a clean separation of HTML views and application logic.</p>
                <p>To add your own template functions, start by editing the XQuery module
                <a data-template="templates:load-source" href="modules/app.xql">app.xql</a>.</p>
            </div>
            <div>
                <div class="row">
                    <div id="content" class="col-md-8">
                        <h2>Manage Recipes</h2>
                        <table>
                            <tr>
                                <td>
                                    <xf:select1 ref="instance('search-instance')/field">
                                        <xf:label/>
                                        <xf:item>
                                            <xf:label>Ingredient</xf:label>
                                            <xf:value>ingredient</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>Title</xf:label>
                                            <xf:value>title</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                </td>
                                <td>
                                    <xf:input class="search" ref="instance('search-instance')/query" incremental="true">
                                        <xf:label/>
                                        <xf:hint>Filter displayed recipes by entering a few characters contained in an ingredient.</xf:hint>
                                        <xf:send submission="search" ev:event="xforms-value-changed"/>
                                    </xf:input>
                                </td>
                                <td>
                                    <xf:trigger class="search">
                                        <xf:label>Clear</xf:label>
                                        <xf:action>
                                            <xf:setvalue ref="instance('search-instance')/query"/>
                                        </xf:action>
                                    </xf:trigger>
                                </td>
                            </tr>
                        </table>
                        <table class="recipes table">
                            <thead>
                                <tr>
                                    <th>Recipe</th>
                                </tr>
                            </thead>
                            <tbody id="recipe-repeat" xf:repeat-nodeset="instance('all')//recipe">
                                <tr>
                                    <td>
                                        <xf:output ref="title"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <xf:group appearance="minimal" class="action-buttons">
                            <xf:submit submission="delete">
                                <xf:label>Delete</xf:label>
                            </xf:submit>
                            <xf:trigger>
                                <xf:label>New</xf:label>
                                <xf:action>
                                    <xf:insert nodeset="instance('all')//recipe" at="last()" position="after" origin="instance('recipe-template')"/>
                                </xf:action>
                            </xf:trigger>
                        </xf:group>
                        <xf:group ref="instance('all')//recipe[index('recipe-repeat')]" appearance="full" class="edit">
                            <xf:input ref="ingredients/ingredient">
                                <xf:label>Ingredient:</xf:label>
                            </xf:input>
                        </xf:group>
                        <xf:submit submission="save">
                            <xf:label>Save</xf:label>
                        </xf:submit>
                    </div>
                    <div class="col-md-4">
                        <div class="well">
                            <p>A simple XForms application which talks to a RESTXQ service defining the following endpoints:</p>
                            <ul>
                                <li>GET /recipes</li>
                                <li>GET /recipes/{$id}</li>
                                <li>PUT /recipe</li>
                                <li>DELETE /recipe/{$id}</li>
                                <li>GET /search?query=&amp;field=</li>
                            </ul>
                            <p>It uses a number of XForms submissions to retrieve data, search, save or delete entries.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p>The page template uses the <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>
                    CSS library for the page layout.</p>
                </div>
                <div class="col-md-6">
                    <div data-template="app:test"/>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <h2>Application Info</h2>
            <div data-template="config:app-info"/>
        </div>
    </div>
</div>