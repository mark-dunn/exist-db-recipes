<div xmlns="http://www.w3.org/1999/xhtml" data-template="templates:surround" data-template-with="templates/page.html" data-template-at="content">
    <div class="row">
        <div class="col-md-8">
            <div class="page-header">
                <h1 data-template="config:app-title">Generated page</h1>
            </div>
            <div class="alert alert-success">
                <p>
                    <a data-template="templates:load-source" href="index.html">This</a> is the entry page into your application 
                and was generated by eXide. It uses HTML templates for a clean separation of HTML views and application logic.</p>
                <p>To add your own template functions, start by editing the XQuery module
                <a data-template="templates:load-source" href="modules/app.xql">app.xql</a>.</p>
            </div>
            <div xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xf="http://www.w3.org/2002/xforms">
                <xf:model>
                    <xf:instance xmlns="" id="all">
                        <recipes/>
                    </xf:instance>
                    <xf:instance xmlns="" id="template">
                        <recipe>
                            <ingredient/>
                        </recipe>
                    </xf:instance>
                    <xf:instance xmlns="" id="search">
                        <parameters>
                            <query/>
                            <field>ingredient</field>
                        </parameters>
                    </xf:instance>
                    <!-- 
            $restxq contains the restxq endpoint, usually /exist/restxq on a default instance.
            It is set as an URL parameter by the controller.
            While it could be hardcoded, we want to make sure it always works if the context changes, e.g. to
            /exist-test/restxq.
        -->
                    <xf:bind id="recipe-id" nodeset="//recipe/@id" relevant="true()"/>
                    <xf:submission id="load" resource="{$restxq}recipe" method="get" replace="instance">
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe list loaded.</xf:message>
                    </xf:submission>
                    <xf:submission id="save" resource="{$restxq}recipe" method="put" replace="instance" ref="//recipe[index('recipe-repeat')]">
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe saved.</xf:message>
                        <xf:message ev:event="xforms-submit-error" level="ephemeral">An error occurred.</xf:message>
                    </xf:submission>
                    <xf:submission id="delete" resource="{$restxq}recipe/{instance('all')//recipe[index('recipe-repeat')]/@id}" method="delete" replace="instance">
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Recipe deleted.</xf:message>
                        <xf:message ev:event="xforms-submit-error" level="ephemeral">An error occurred.</xf:message>
                    </xf:submission>
                    <xf:submission id="search" resource="{$restxq}search" method="get" serialization="application/x-www-form-urlencoded" ref="instance('search')" targetref="instance('all')" replace="instance"/>
                    <xf:action ev:event="xforms-ready">
                        <xf:send submission="load"/>
                    </xf:action>
                </xf:model>
                <div class="row">
                    <div id="content" class="col-md-8">
                        <h2>Manage Recipes</h2>
                        <table>
                            <tr>
                                <td>
                                    <xf:select1 ref="instance('search')/field">
                                        <xf:label/>
                                        <xf:item>
                                            <xf:label>Ingredient</xf:label>
                                            <xf:value>ingredient</xf:value>
                                        </xf:item>
                                    </xf:select1>
                                </td>
                                <td>
                                    <xf:input class="search" ref="instance('search')/query" incremental="true">
                                        <xf:label/>
                                        <xf:hint>Filter displayed recipes by entering a few characters contained in an ingredient.</xf:hint>
                                        <xf:send submission="search" ev:event="xforms-value-changed"/>
                                    </xf:input>
                                </td>
                                <td>
                                    <xf:trigger class="search">
                                        <xf:label>Clear</xf:label>
                                        <xf:action>
                                            <xf:setvalue ref="instance('search')/query"/>
                                        </xf:action>
                                    </xf:trigger>
                                </td>
                            </tr>
                        </table>
                        <table class="recipes table">
                            <thead>
                                <th>Ingredient</th>
                            </thead>
                            <tbody id="recipe-repeat" xf:repeat-nodeset="//recipe">
                                <tr>
                                    <td>
                                        <xf:output ref="ingredient"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <xf:group appearance="minimal" class="action-buttons">
                            <xf:submit submission="delete">
                                <xf:label>Delete</xf:label>
                            </xf:submit>
                            <xf:trigger>
                                <xf:label>New</xf:label>
                                <xf:action>
                                    <xf:insert nodeset="//recipe" at="last()" position="after" origin="instance('template')"/>
                                </xf:action>
                            </xf:trigger>
                        </xf:group>
                        <xf:group ref="//recipe[index('recipe-repeat')]" appearance="full" class="edit">
                            <xf:input ref="ingredient">
                                <xf:label>Ingredient:</xf:label>
                            </xf:input>
                        </xf:group>
                        <xf:submit submission="save">
                            <xf:label>Save</xf:label>
                        </xf:submit>
                    </div>
                    <div class="col-md-4">
                        <div class="well">
                            <p>A simple XForms application which talks to a RESTXQ service defining the following endpoints:</p>
                            <ul>
                                <li>GET /recipes</li>
                                <li>GET /recipes/{$id}</li>
                                <li>PUT /resipes</li>
                                <li>DELETE /recipes/{$id}</li>
                                <li>GET /search?query=&amp;field=</li>
                            </ul>
                            <p>It uses a number of XForms submissions to retrieve data, search, save or delete entries.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p>The page template uses the <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>
                    CSS library for the page layout.</p>
                </div>
                <div class="col-md-6">
                    <div data-template="app:test"/>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <h2>Application Info</h2>
            <div data-template="config:app-info"/>
        </div>
    </div>
</div>